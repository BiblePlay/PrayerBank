<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="color-scheme" content="light" />
<meta name="theme-color" content="#f6f7fb" />
<title>ê¸°ë„í†µì¥</title>

<style>
:root{
  color-scheme: light;
  --bg:#f6f7fb;
  --card:#ffffff;
  --text:#101828;
  --muted:#667085;
  --line:rgba(16,24,40,.10);
  --blue:#2563eb;
  --blue2:#4f7dff;
  --shadow: 0 14px 36px rgba(16,24,40,.10);
  --radius: 22px;
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
  --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
          "Apple SD Gothic Neo","Noto Sans KR","Malgun Gothic", sans-serif;
}
*{box-sizing:border-box}
html,body{-webkit-text-size-adjust:100%}
body{
  margin:0;
  font-family:var(--sans);
  color:var(--text);
  background:
    radial-gradient(900px 520px at 15% -10%, rgba(37,99,235,.10), transparent 60%),
    radial-gradient(800px 460px at 90% 0%, rgba(99,102,241,.10), transparent 65%),
    var(--bg);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:22px;
}
.wrap{ width:min(1120px,100%); display:grid; gap:16px; }
.grid{ display:grid; grid-template-columns: 1.2fr .8fr; gap:16px; }
@media (max-width:920px){ .grid{ grid-template-columns:1fr; } }

.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  overflow:hidden;
}

/* Header */
.header{
  padding:18px 18px 14px;
  border-bottom:1px solid var(--line);
  display:grid;
  grid-template-columns: 1fr auto;
  gap:14px;
  align-items:start;
}
.brand{ display:flex; flex-direction:column; gap:8px; min-width:0; }
.brand .title{ font-size:26px; font-weight:950; letter-spacing:-.03em; line-height:1.1; }

.metaRow{
  display:flex; gap:10px; flex-wrap:wrap; align-items:center;
  color:var(--muted); font-size:12.5px;
}
@media (min-width:521px){
  .metaRow{ flex-direction:column; align-items:flex-start; gap:6px; }
}
.pill{
  display:inline-flex; align-items:center; gap:7px;
  padding:6px 10px; border-radius:999px;
  border:1px solid var(--line); background:rgba(16,24,40,.03);
  white-space:nowrap;
}
.dot{
  width:8px;height:8px;border-radius:999px;
  background:linear-gradient(135deg, var(--blue2), var(--blue));
  box-shadow:0 0 0 3px rgba(37,99,235,.10);
}
.mono{ font-family:var(--mono); }

.balance{
  text-align:right;
  display:flex; flex-direction:column; gap:6px;
  align-items:flex-end; min-width:0;
}
.balance .label{ font-size:12px; color:var(--muted); }
.balance .num{
  font-size: clamp(28px, 4.2vw, 44px);
  font-weight:950;
  font-family:var(--mono);
  letter-spacing:-.02em;
  line-height:1;
  white-space:nowrap;
}
.balance .num.shrink{ font-size: clamp(24px, 3.6vw, 38px); }
.balance .mini{ font-size:12px; color:var(--muted); }

@media (max-width:520px){
  .header{ grid-template-columns:1fr; gap:10px; }
  .balance{ text-align:left; align-items:flex-start; }
  .balance .num{ font-size: clamp(26px, 7vw, 40px); }
}

/* Body */
.body{ padding:16px 18px 18px; display:grid; gap:14px; }
.tabs{ display:flex; gap:10px; flex-wrap:wrap; }
.tab{
  padding:11px 14px; border-radius:16px;
  border:1px solid var(--line); background:#fff;
  cursor:pointer; font-size:14px; font-weight:900; color:var(--text);
  transition:.12s ease; user-select:none;
}
.tab:hover{ background:rgba(16,24,40,.02); }
.tab.active{
  border-color:rgba(37,99,235,.35);
  background:linear-gradient(180deg, rgba(37,99,235,.10), rgba(37,99,235,.06));
  box-shadow: 0 10px 26px rgba(37,99,235,.12);
}

.stepper{
  border:1px solid var(--line);
  border-radius:18px;
  padding:14px;
  background:linear-gradient(180deg, rgba(37,99,235,.06), #fff);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  flex-wrap:nowrap;
}
.stepper .meta{ display:flex; flex-direction:column; gap:5px; min-width:0; flex:1 1 auto; }
.stepper .meta .k{ font-size:12px; color:var(--muted); }
.stepper .meta .v{
  font-size:14px; font-weight:950;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.controls{ display:flex; align-items:center; gap:12px; flex:0 0 auto; }
.btnMini{
  width:clamp(56px, 16vw, 62px);
  height:clamp(56px, 16vw, 62px);
  border-radius:20px;
  border:1px solid rgba(37,99,235,.22);
  background:rgba(37,99,235,.10);
  color:var(--blue);
  font-size:24px;
  font-weight:950;
  cursor:pointer;
  transition:.12s ease;
  display:grid;
  place-items:center;
}
.btnMini:hover{ background:rgba(37,99,235,.14); }
.btnMini:active{ transform:scale(.98); }

.countBox{
  width:clamp(96px, 24vw, 120px);
  height:clamp(56px, 16vw, 62px);
  border-radius:20px;
  border:1px solid var(--line);
  background:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
}
.countBox .mins{ font-family:var(--mono); font-size:24px; font-weight:950; }
.countBox .unit{ font-size:13px; color:var(--muted); font-weight:800; }

@media (max-width:380px){
  .stepper{ flex-direction:column; align-items:stretch; }
  .controls{ justify-content:space-between; }
  .countBox{ width:auto; flex:1; }
}

.btnMain{
  width:100%;
  padding:16px 16px;
  border-radius:18px;
  border:1px solid rgba(37,99,235,.25);
  background:linear-gradient(135deg, rgba(37,99,235,.92), rgba(99,102,241,.92));
  color:#fff;
  font-weight:950;
  cursor:pointer;
  font-size:16px;
  box-shadow: 0 14px 30px rgba(37,99,235,.22);
}
.btnMain:active{ transform:translateY(1px); }

.note{ font-size:12px; color:var(--muted); line-height:1.5; }

/* Side */
.side{ padding:16px 16px 18px; display:grid; gap:12px; }
.box{ border:1px solid var(--line); border-radius:18px; padding:14px; background:#fff; }
.row{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
.k{ font-size:12px; color:var(--muted); font-weight:900; }
.v{ font-size:13px; font-family:var(--mono); font-weight:950; color:rgba(16,24,40,.76); }
.bigv{ font-size:26px; font-family:var(--mono); font-weight:950; letter-spacing:-.02em; }

.coinRow{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
.coinPack{ display:flex; align-items:center; gap:10px; }
.coinImg{ width:48px; height:48px; object-fit:contain; display:block; }
.countTag{
  font-family:var(--mono);
  font-size:13px;
  font-weight:950;
  color:var(--text);
  padding:6px 10px;
  border-radius:999px;
  border:1px solid var(--line);
  background:rgba(16,24,40,.03);
}

/* ì•„ì£¼ ì§§ì€ ì½”ì¸ ê°•ì¡°(ê³¼í•˜ì§€ ì•Šê²Œ) */
@keyframes coinSoft{
  0%{ transform:scale(1); filter:none; }
  50%{ transform:scale(1.06); filter: drop-shadow(0 12px 16px rgba(245,158,11,.26)); }
  100%{ transform:scale(1); filter:none; }
}
.coinCelebrate{ animation: coinSoft 420ms ease-out; }

.btnGhost{
  width:100%;
  padding:14px 14px;
  border-radius:18px;
  border:1px solid rgba(37,99,235,.20);
  background:rgba(37,99,235,.08);
  color:var(--text);
  font-weight:950;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.btnGhost:hover{ background:rgba(37,99,235,.11); }
.btnGhost .sub{ color:var(--muted); font-weight:800; font-size:13px; }

.catList{ display:grid; gap:10px; margin-top:10px; }
.catItem{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:10px 12px;
  border:1px solid var(--line);
  border-radius:16px;
  background:linear-gradient(180deg, rgba(37,99,235,.04), #fff);
  cursor:pointer;
}
.catItem:hover{ background:linear-gradient(180deg, rgba(37,99,235,.06), #fff); }
.catLeft{ display:flex; flex-direction:column; gap:3px; min-width:0; }
.catName{ font-weight:950; font-size:13px; }
.catSub{ color:var(--muted); font-size:12px; font-family:var(--mono); }
.catRight{ text-align:right; font-family:var(--mono); font-weight:950; white-space:nowrap; }
.bar{ height:8px; border-radius:999px; background:rgba(16,24,40,.08); overflow:hidden; margin-top:8px; }
.bar > div{ height:100%; width:0%; background:linear-gradient(90deg, rgba(37,99,235,.92), rgba(99,102,241,.80)); border-radius:999px; }

/* Modal */
.modalOverlay{
  position:fixed; inset:0;
  background: rgba(16,24,40,.45);
  display:none;
  align-items:flex-end;
  justify-content:center;
  padding:16px;
  z-index:50;
}
.modalOverlay.show{ display:flex; }

/* âœ… ëª¨ë°”ì¼ ìƒë‹¨ ì˜ë¦¼ ë°©ì§€: max-height + ë‚´ë¶€ ìŠ¤í¬ë¡¤ */
.sheet{
  width:min(760px, 100%);
  background:#fff;
  border:1px solid rgba(16,24,40,.12);
  border-radius: 24px;
  box-shadow: 0 24px 80px rgba(16,24,40,.28);
  overflow:hidden;
  max-height: calc(100vh - 24px);
  display:flex;
  flex-direction:column;
}
.sheetHead{
  padding:14px 16px;
  border-bottom:1px solid rgba(16,24,40,.10);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex:0 0 auto;
}
.sheetHead .leftHead{ display:flex; align-items:center; gap:10px; min-width:0; }
.rightHead{ display:flex; align-items:center; gap:10px; flex:0 0 auto; }
.sheetHead .t{ font-weight:950; font-size:16px; white-space:nowrap; }
.btnMiniGhost{
  border:1px solid rgba(16,24,40,.10);
  background: rgba(16,24,40,.03);
  color: rgba(16,24,40,.78);
  padding:8px 10px;
  border-radius:14px;
  cursor:pointer;
  font-weight:900;
  font-size:13px;
}
.btnMiniGhost:hover{ background: rgba(16,24,40,.05); }

.sheetBody{
  padding:16px;
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:14px;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
  flex:1 1 auto;
}
@media (max-width:700px){ .sheetBody{ grid-template-columns:1fr; } }

.donutCard{
  border:1px solid rgba(16,24,40,.10);
  background: rgba(37,99,235,.03);
  border-radius:18px;
  padding:14px;
}
.donutTop{
  display:flex; align-items:flex-end; justify-content:space-between; gap:10px;
  margin-bottom:10px;
}
.donutTop .h{ font-weight:950; }
.donutTop .m{ color:rgba(16,24,40,.60); font-size:13px; font-family:var(--mono); }

.donutWrap{ display:grid; place-items:center; padding:6px 0 10px; }
.donutCenter{
  position:absolute;
  text-align:center;
  pointer-events:none;
  transform: translateY(2px);
}
.donutCenter .amt{ font-family:var(--mono); font-size:22px; font-weight:950; }
.donutCenter .lbl{ color:rgba(16,24,40,.60); font-size:13px; margin-top:4px; }

.legendList{ display:grid; gap:10px; }
.legendItem{
  border:1px solid rgba(16,24,40,.10);
  background:#fff;
  border-radius:16px;
  padding:12px;
  cursor:pointer;
  display:flex; align-items:center; justify-content:space-between; gap:10px;
}
.legendItem:hover{ background: rgba(37,99,235,.05); }
.legendL{ display:flex; align-items:center; gap:10px; min-width:0; }
.swatch{ width:12px; height:12px; border-radius:999px; }
.legendName{ font-weight:950; }
.legendHint{
  color:rgba(16,24,40,.55);
  font-family:var(--mono);
  font-size:12.5px;
  margin-top:2px;
  display:none; /* âœ… ê¸°ë³¸ì€ ìˆ¨ê¹€ */
}
.legendItem.selected .legendHint{ display:block; } /* âœ… ì„ íƒì‹œì—ë§Œ í¼ì„¼íŠ¸/ë¶„ í‘œì‹œ */
.legendAmt{ font-family:var(--mono); font-weight:950; white-space:nowrap; }

.btnCloseBlue{
  padding:12px 14px;
  border-radius:16px;
  border:1px solid rgba(37,99,235,.25);
  background:linear-gradient(135deg, rgba(37,99,235,.92), rgba(99,102,241,.92));
  color:#fff;
  font-weight:950;
  cursor:pointer;
}

/* Toast + Fireworks(ì•„ë˜â†’ìœ„) */
.toast{
  position:fixed;
  left:50%;
  top:18px;
  transform:translateX(-50%);
  background:#fff;
  border:1px solid rgba(16,24,40,.12);
  box-shadow: 0 18px 42px rgba(16,24,40,.18);
  padding:10px 12px;
  border-radius:16px;
  display:flex;
  align-items:center;
  gap:10px;
  opacity:0;
  pointer-events:none;
  transition: .18s ease;
  z-index:200; /* âœ… PCì—ì„œë„ í•­ìƒ ë³´ì´ê²Œ */
}
.toast.show{ opacity:1; transform:translateX(-50%) translateY(2px); }
.toast .badge{
  width:34px; height:34px;
  border-radius:12px;
  background: rgba(245,158,11,.14);
  display:grid;
  place-items:center;
  font-size:18px;
}
.toast .t{ font-weight:950; }
.toast .s{ color:rgba(16,24,40,.60); font-size:12px; margin-top:2px; }

.fireWrap{
  position:fixed; inset:0;
  pointer-events:none;
  overflow:hidden;
  z-index:150;
}
.spark{
  position:absolute;
  width:8px; height:12px;
  border-radius:3px;
  opacity:.95;
  transform: translateY(0) rotate(0deg);
  animation: rise 950ms ease-out forwards;
}
@keyframes rise{
  0%{ transform: translateY(0) rotate(0deg); opacity:.95; }
  70%{ opacity:.95; }
  100%{ transform: translateY(-115vh) rotate(220deg); opacity:0; }
}

/* ===== fireworks (top/bottom) ===== */
#fireWrap{ position: fixed; inset:0; pointer-events:none; z-index:99999; }
.fw{ position: fixed; border-radius: 999px; filter: drop-shadow(0 6px 10px rgba(0,0,0,.15)); }
@keyframes fwDown { 
  0%{ transform: translateY(0) scale(1); opacity:1; }
  100%{ transform: translateY(42vh) scale(.85); opacity:0; }
}
@keyframes fwUp { 
  0%{ transform: translateY(0) scale(1); opacity:1; }
  100%{ transform: translateY(-42vh) scale(.85); opacity:0; }
}
.fwDown{ animation-name: fwDown; animation-timing-function: cubic-bezier(.2,.8,.2,1); }
.fwUp{ animation-name: fwUp; animation-timing-function: cubic-bezier(.2,.8,.2,1); }

</style>

<!-- PWA (GitHub Pages) -->
<script>

(function(){
  // file:// ë¡œ ì—´ë©´ manifest/service workerê°€ CORS/ë³´ì•ˆ ì •ì±…ìœ¼ë¡œ ë§‰í ìˆ˜ ìˆì–´ìš”.
  if(!location.protocol.startsWith('http')) return;

  // manifest
  var link = document.createElement('link');
  link.rel = 'manifest';
  link.href = './manifest.json';
  document.head.appendChild(link);

  // iOS í™ˆí™”ë©´ ì•„ì´ì½˜/í…Œë§ˆ
  var apple = document.createElement('link');
  apple.rel = 'apple-touch-icon';
  apple.href = './icons/icon-192.png';
  document.head.appendChild(apple);

  // service worker
  if('serviceWorker' in navigator){
    window.addEventListener('load', function(){
      navigator.serviceWorker.register('./sw.js').catch(function(){});
    });
  }
})();

</script>

</head>

<body>
<div class="wrap">
  <div class="grid">
    <!-- LEFT -->
    <section class="card">
      <div class="header">
        <div class="brand">
          <div class="title" id="adminTrigger">ê¸°ë„í†µì¥</div>
          <div class="metaRow">
            <span class="pill"><span class="dot"></span><span>PRAYER BANK</span></span>
            <span class="mono" id="today"></span>
          </div>
        </div>
        <div class="balance">
          <div class="label">ì´ ì ë¦½ê¸ˆ</div>
          <div class="num" id="totalAmount">â‚©0</div>
          <div class="mini">1ë¶„ = <b>â‚©10,000</b> ì ë¦½</div>
        </div>
      </div>

      <div class="body">
        <div class="tabs" id="tabs"></div>

        <div class="stepper">
          <div class="meta">
            <div class="k">ì‹œê°„(ë¶„)</div>
            <div class="v" id="activeInfo">ë‚˜</div>
          </div>
          <div class="controls">
            <button class="btnMini" id="minus" aria-label="minus">âˆ’</button>
            <div class="countBox">
              <span class="mins" id="mins">0</span>
              <span class="unit">min</span>
            </div>
            <button class="btnMini" id="plus" aria-label="plus">+</button>
          </div>
        </div>

        <button class="btnMain" id="add">ì ë¦½í•˜ê¸°</button>
        <div class="note">* ê¸ˆì•¡/ë¶„ ê¸°ë¡ì€ ì´ ê¸°ê¸°(ë¸Œë¼ìš°ì €)ì— ì €ì¥ë©ë‹ˆë‹¤.</div>
      </div>
    </section>

    <!-- RIGHT -->
    <aside class="card">
      <div class="side">
        <div class="box">
          <div class="row">
            <div class="k">ì „ì²´ ëˆ„ì </div>
            <div class="bigv" id="sideTotal">â‚©0</div>
          </div>
        </div>

        <div class="box">
          <div class="coinRow">
            <div class="k" style="color:var(--text);">ê³¨ë“œì½”ì¸ ë³´ê¸°</div>
            <div class="coinPack">
              <img class="coinImg" id="coinImg" alt="gold coin" />
              <span class="countTag" id="coinCount">Ã—0</span>
            </div>
          </div>
          <div class="note" style="margin-top:8px;">* <b>â‚©1,000,000</b>ë§ˆë‹¤ ì½”ì¸ 1ê°œ</div>
        
          <div style="display:flex; gap:10px; margin-top:10px; justify-content:flex-end;">
            <button class="btnMiniGhost" id="backupBtn" title="ë°±ì—… ì €ì¥">â¬‡ï¸ ì €ì¥</button>
          </div>
</div>

        <div class="box">
          <button class="btnGhost" id="openChart">
            <span style="font-weight:950;">ê¸°ë„ì°¨íŠ¸ ë¶„ì„</span>
            <span class="sub">ë„ë„› ì°¨íŠ¸ë¡œ ë³´ê¸°</span>
          </button>

          <div class="row" style="margin-top:12px;">
            <div class="k">ì¹´í…Œê³ ë¦¬ë³„ ëˆ„ì </div>
            <div class="v" id="breakHint">â€”</div>
          </div>
          <div class="catList" id="catList"></div>
        </div>
      </div>
    </aside>
  </div>
</div>


<!-- Admin Panel (Hidden, toggled by F1) -->
<div id="adminPanel" style="
  position:fixed; right:16px; bottom:16px; z-index:9999;
  width:min(420px, calc(100vw - 32px));
  background:#fff; border:1px solid rgba(16,24,40,.12);
  border-radius:18px; box-shadow:0 24px 80px rgba(16,24,40,.28);
  padding:14px; display:none;">
  <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
    <div style="font-weight:950;">ê´€ë¦¬ì ëª¨ë“œ</div>
    <button id="adminClose" style="
      padding:8px 10px; border-radius:14px; border:1px solid rgba(16,24,40,.12);
      background:rgba(16,24,40,.04); cursor:pointer; font-weight:900;">ë‹«ê¸°</button>
  </div>

  <div style="margin-top:10px; color:rgba(16,24,40,.65); font-size:12px; line-height:1.45;">
    â€¢ <b>F1</b>ë¡œ ì—´ê¸°/ë‹«ê¸° (ì¼ë°˜ í™”ë©´ì—ì„œëŠ” ìˆ¨ê¹€)<br/>
    â€¢ ì‹œê°„ ìˆ˜ì •ì€ <b>í˜„ì¬ ì„ íƒëœ ì¹´í…Œê³ ë¦¬</b>ì— ì ìš©ë©ë‹ˆë‹¤.
  </div>

  <div style="margin-top:12px; display:grid; grid-template-columns:1fr 1fr; gap:10px;">
    <button id="adminMinus" style="
      padding:12px; border-radius:16px; border:1px solid rgba(37,99,235,.20);
      background:rgba(37,99,235,.08); cursor:pointer; font-weight:950;">
      1ë¶„ ë¹¼ê¸° (âˆ’)
    </button>
    <button id="adminPlus" style="
      padding:12px; border-radius:16px; border:1px solid rgba(37,99,235,.20);
      background:rgba(37,99,235,.08); cursor:pointer; font-weight:950;">
      1ë¶„ ë”í•˜ê¸° (+)
    </button>
  </div>

  
  <div style="margin-top:12px; border-top:1px solid rgba(16,24,40,.10); padding-top:12px;">
    <div style="font-weight:950; margin-bottom:8px;">ë°±ì—…/ë³µêµ¬</div>
    <div style="color:rgba(16,24,40,.65); font-size:12px; line-height:1.45;">
      â€¢ <b>ì €ì¥</b>: ì´ ê¸°ê¸°ì˜ ê¸°ë¡ì„ íŒŒì¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.<br/>
      â€¢ <b>ë³µêµ¬</b>: ì €ì¥í•´ë‘” íŒŒì¼ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
    </div>
    <div style="display:flex; gap:10px; margin-top:10px;">
      <button id="restoreBtn" style="
        flex:1; padding:12px 14px; border-radius:14px;
        border:1px solid rgba(37,99,235,.25);
        background:rgba(37,99,235,.08);
        color:var(--text); font-weight:950; cursor:pointer;">
        â¬†ï¸ ë³µêµ¬
      </button>
      <input type="file" id="restoreFile" accept="application/json" hidden>
    </div>
  </div>

<div style="margin-top:12px; border-top:1px solid rgba(16,24,40,.10); padding-top:12px;">
    <div style="font-weight:950; margin-bottom:8px;">ì´ˆê¸°í™”(ìœ„í—˜)</div>
    <div style="color:rgba(16,24,40,.65); font-size:12px; line-height:1.45;">
      ì•„ë˜ ì¹¸ì— <b>RESET</b> ì„ ì…ë ¥í•´ì•¼ ì´ˆê¸°í™”ë©ë‹ˆë‹¤. (2ì¤‘ í™•ì¸)
    </div>

    <div style="display:flex; gap:10px; margin-top:10px;">
      <input id="adminResetText" placeholder="RESET ì…ë ¥" style="
        flex:1; padding:12px 12px; border-radius:14px;
        border:1px solid rgba(16,24,40,.14); outline:none;">
      <button id="adminReset" style="
        padding:12px 14px; border-radius:14px;
        border:1px solid rgba(239,68,68,.30);
        background:rgba(239,68,68,.10);
        color:#b42318; font-weight:950; cursor:pointer;">
        ì´ˆê¸°í™”
      </button>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modalOverlay" id="modal">
  <div class="sheet" role="dialog" aria-modal="true">
    <div class="sheetHead">
      <div class="leftHead">
        <div class="t">ê¸°ë„ì°¨íŠ¸ ë¶„ì„</div>
      </div>
      <div class="rightHead">
        <button class="btnMiniGhost" id="resetDonut" title="ì „ì²´ ë³´ê¸°">ì „ì²´</button>
        <button class="btnCloseBlue" id="closeModal">ë‹«ê¸°</button>
      </div>
    </div>

    <div class="sheetBody">
      <div class="donutCard">
        <div class="donutTop">
          <div class="h">ì¹´í…Œê³ ë¦¬ ë¹„ìœ¨</div>
          <div class="m" id="donutTotal">â‚©0</div>
        </div>

        <div class="donutWrap" style="position:relative;">
          <div class="donutCenter">
            <div class="amt" id="centerAmt">â‚©0</div>
            <div class="lbl" id="centerLbl">ì „ì²´</div>
          </div>
          <svg id="donutSvg" width="260" height="260" viewBox="0 0 260 260" aria-label="donut chart"></svg>
        </div>

        <div class="note" style="margin:0;">
          * ì¡°ê°(ìƒ‰)ì„ ëˆ„ë¥´ë©´ í•­ëª©ì—ì„œ ìì„¸íˆ ë³´ì…ë‹ˆë‹¤. (ì „ì²´ë¡œ: â€œì „ì²´â€)
        </div>
      </div>

      <div class="donutCard">
        <div class="donutTop">
          <div class="h">í•­ëª©</div>
          <div class="m" id="selectedMeta">â— ì „ì²´</div>
        </div>
        <div class="legendList" id="legend"></div>
      </div>
    </div>
  </div>
</div>

<!-- Toast + Fireworks -->
<div class="toast" id="toast">
  <div class="badge">ğŸ‰</div>
  <div>
    <div class="t">ì¶•í•˜í•´ìš”!</div>
    <div class="s" id="toastSub">ê³¨ë“œì½”ì¸ +1</div>
  </div>
</div>
<div class="fireWrap" id="fireWrap"></div>

<script>
/* ===== ì„¤ì • ===== */
const RATE = 10000;
const COIN_UNIT = 1_000_000;

const cats = [
  { key:"me",       label:"ë‚˜",       color:"#2563eb" },
  { key:"family",   label:"ê°€ì¡±",     color:"#4f7dff" },
  { key:"nation",   label:"ë‚˜ë¼",     color:"#7c3aed" },
  { key:"neighbor", label:"ì´ì›ƒ",     color:"#06b6d4" },
  { key:"special",  label:"íŠ¹ë³„ê¸°ë„",  color:"#f59e0b" },
  { key:"vow",      label:"ì‘ì •ê¸°ë„",  color:"#ef4444" },
];

const YEAR = new Date().getFullYear();
const STORAGE_KEY = `prayer_bank_${YEAR}_v1`;
const LEGACY_KEY = "prayer_bank_stable_coin_v1";

/* ===== ìƒíƒœ ===== */
let state = load() || {
  activeKey: "me",
  total: 0,
  minsByCat: Object.fromEntries(cats.map(c => [c.key, 0])),
  amtByCat: Object.fromEntries(cats.map(c => [c.key, 0])),
};
let pending = 0;

/* ===== ì—˜ë¦¬ë¨¼íŠ¸ ===== */
const tabsEl = document.getElementById("tabs");
const totalEl = document.getElementById("totalAmount");
const sideTotalEl = document.getElementById("sideTotal");
const activeInfoEl = document.getElementById("activeInfo");
const minsEl = document.getElementById("mins");
const catListEl = document.getElementById("catList");
const breakHintEl = document.getElementById("breakHint");

const coinImgEl = document.getElementById("coinImg");
const coinCountEl = document.getElementById("coinCount");

const modalEl = document.getElementById("modal");
const donutSvg = document.getElementById("donutSvg");
const donutTotalEl = document.getElementById("donutTotal");
const centerAmtEl = document.getElementById("centerAmt");
const centerLblEl = document.getElementById("centerLbl");
const legendEl = document.getElementById("legend");
const selectedMetaEl = document.getElementById("selectedMeta");
const resetDonutBtn = document.getElementById("resetDonut");

const toastEl = document.getElementById("toast");
const toastSubEl = document.getElementById("toastSub");
const fireWrap = document.getElementById("fireWrap");

/* ë‚ ì§œ */
document.getElementById("today").textContent =
  new Date().toLocaleDateString("ko-KR", { year:"numeric", month:"2-digit", day:"2-digit" });

/* ===== ì½”ì¸ ì´ë¯¸ì§€: ì•ˆì „í•œ ë°©ì‹ (URL + ì‹¤íŒ¨ì‹œ ì§§ì€ SVG fallback) ===== */
const COIN_URL = "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1fa99.png"; // coin
const COIN_FALLBACK =
  "data:image/svg+xml;charset=utf-8," + encodeURIComponent(`
  <svg xmlns="http://www.w3.org/2000/svg" width="128" height="128" viewBox="0 0 64 64">
    <defs>
      <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0" stop-color="#fff3b0"/>
        <stop offset="0.45" stop-color="#facc15"/>
        <stop offset="1" stop-color="#f59e0b"/>
      </linearGradient>
    </defs>
    <circle cx="32" cy="32" r="23" fill="url(#g)" stroke="rgba(16,24,40,.18)" stroke-width="2"/>
    <circle cx="32" cy="32" r="17" fill="rgba(255,255,255,.10)"/>
    <path d="M20 26h24v4H20z" fill="rgba(16,24,40,.14)"/>
    <path d="M23 30v18M29 30v18M35 30v18M41 30v18" stroke="rgba(255,255,255,.65)" stroke-width="2" stroke-linecap="round"/>
    <path d="M18 48h28" stroke="rgba(16,24,40,.18)" stroke-width="3" stroke-linecap="round"/>
  </svg>
`);
coinImgEl.src = COIN_URL;
coinImgEl.onerror = () => { coinImgEl.src = COIN_FALLBACK; };


/* ===== ë°±ì—…(ì €ì¥) / ë³µêµ¬ ===== */
const backupBtn = document.getElementById("backupBtn");
const restoreBtn = document.getElementById("restoreBtn");
const restoreFile = document.getElementById("restoreFile");

function buildBackupPayload(){
  const date = new Date();
  return {
    app: "PrayerBank",
    version: 1,
    year: YEAR,
    savedAt: date.toISOString(),
    storageKey: STORAGE_KEY,
    state
  };
}

function downloadJson(filename, obj){
  const blob = new Blob([JSON.stringify(obj, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(()=>URL.revokeObjectURL(url), 6000);
}

if(backupBtn){
  backupBtn.addEventListener("click", () => {
    const y = YEAR;
    const date = new Date().toISOString().slice(0,10);
    downloadJson(`prayerbank_${y}_${date}.json`, buildBackupPayload());
  });
}

if(restoreBtn && restoreFile){
  restoreBtn.addEventListener("click", () => restoreFile.click());

  restoreFile.addEventListener("change", (e) => {
    const file = e.target.files && e.target.files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = () => {
      try{
        const data = JSON.parse(reader.result);

        if(!data || data.app !== "PrayerBank" || !data.state){
          alert("ì˜¬ë°”ë¥¸ ê¸°ë„í†µì¥ ë°±ì—… íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.");
          return;
        }

        if(!confirm("ì´ íŒŒì¼ë¡œ í˜„ì¬ ê¸°ë¡ì„ ë®ì–´ì¨ì„œ ë³µêµ¬í• ê¹Œìš”?")) return;

        state = data.state;

        // ëˆ„ë½ í‚¤ ë°©ì–´ (ë²„ì „ ì°¨ì´ ëŒ€ë¹„)
        state.activeKey = state.activeKey || "me";
        state.total = Number(state.total || 0);
        state.minsByCat = state.minsByCat || Object.fromEntries(cats.map(c => [c.key, 0]));
        state.amtByCat  = state.amtByCat  || Object.fromEntries(cats.map(c => [c.key, 0]));
        for(const c of cats){
          if(state.minsByCat[c.key] == null) state.minsByCat[c.key] = 0;
          if(state.amtByCat[c.key] == null) state.amtByCat[c.key] = 0;
        }

        pending = 0;
        minsEl.textContent = "0";
        prevCoins = null;

        save();
        render();
        alert("ë³µêµ¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
      }catch(err){
        alert("íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (JSON í˜•ì‹ ì˜¤ë¥˜)");
      }finally{
        restoreFile.value = "";
      }
    };
    reader.readAsText(file, "utf-8");
  });
}


/* ===== ìœ í‹¸ ===== */
const won = (n) => "â‚©" + Math.round(n).toLocaleString("ko-KR");
function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
function load(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw) return JSON.parse(raw);

    // âœ… ì—°ë„í‚¤ê°€ ë¹„ì—ˆìœ¼ë©´: ì´ì „ ë²„ì „(legacy) ê°’ì´ ìˆìœ¼ë©´ ê°€ì ¸ì™€ì„œ ì €ì¥
    const legacy = localStorage.getItem(LEGACY_KEY);
    if(legacy){
      localStorage.setItem(STORAGE_KEY, legacy);
      return JSON.parse(legacy);
    }
    return null;
  }catch(e){
    return null;
  }
}
function activeCat(){ return cats.find(c => c.key === state.activeKey) || cats[0]; }

/* í° ê¸ˆì•¡ fit */
function fitAmount(){
  const digits = totalEl.textContent.replace(/[^\d]/g,'').length;
  if(digits >= 10) totalEl.classList.add("shrink");
  else totalEl.classList.remove("shrink");
}

/* ===== íƒ­ ===== */
function renderTabs(){
  tabsEl.innerHTML = "";
  cats.forEach(c => {
    const b = document.createElement("button");
    b.className = "tab" + (c.key === state.activeKey ? " active" : "");
    b.textContent = c.label;
    b.onclick = () => {
      state.activeKey = c.key;
      pending = 0;
      minsEl.textContent = "0";
      save();
      render();
    };
    tabsEl.appendChild(b);
  });
}

/* ===== í—¤ë” ===== */
function renderHeader(){
  totalEl.textContent = won(state.total);
  sideTotalEl.textContent = won(state.total);
  activeInfoEl.textContent = activeCat().label;
  fitAmount();
}

/* ===== ì¶•í•˜(í† ìŠ¤íŠ¸ 3ì´ˆ + ì•„ë˜â†’ìœ„ í­ì£½) ===== */
function showToast(addN){
  toastSubEl.textContent = `ê³¨ë“œì½”ì¸ +${addN}`;
  toastEl.classList.add("show");
  clearTimeout(toastEl._t);
  toastEl._t = setTimeout(()=>toastEl.classList.remove("show"), 3000); // âœ… 3ì´ˆ
}

/* ì•„ë˜ì—ì„œ ìœ„ë¡œ â€œí­ì£½â€ */
function fireUp(){
  const colors = ["#2563eb","#4f7dff","#f59e0b","#22c55e","#ef4444","#a855f7"];
  const baseX = 50 + (Math.random()*20 - 10); // ì¤‘ì•™ ê·¼ì²˜
  for(let i=0;i<28;i++){
    const p = document.createElement("div");
    p.className = "spark";
    p.style.left = (baseX + (Math.random()*40 - 20)) + "vw";
    p.style.top  = (92 + Math.random()*8) + "vh"; // âœ… ì•„ë˜ì—ì„œ ì‹œì‘
    p.style.background = colors[Math.floor(Math.random()*colors.length)];
    p.style.animationDuration = (820 + Math.random()*420) + "ms";
    p.style.width = (7 + Math.random()*8) + "px";
    p.style.height = (10 + Math.random()*10) + "px";
    fireWrap.appendChild(p);
    p.addEventListener("animationend", ()=> p.remove());
  }
}

function celebrateCoin(addN){
  coinImgEl.classList.remove("coinCelebrate");
  void coinImgEl.offsetWidth;
  coinImgEl.classList.add("coinCelebrate");
  showToast(addN);
  fireUp();
}

/* ===== ì½”ì¸ ===== */
let prevCoins = null;
function renderCoins(){
  const coins = Math.floor(state.total / COIN_UNIT);
  coinCountEl.textContent = `Ã—${coins}`;
  if(prevCoins === null) prevCoins = coins;
  if(coins > prevCoins){
    celebrateCoin(coins - prevCoins);
    prevCoins = coins;
  }
}

/* ===== ì¹´í…Œê³ ë¦¬ ë¦¬ìŠ¤íŠ¸ ===== */
function renderCatList(){
  let maxKey=null, maxAmt=-1;
  for(const c of cats){
    const amt = state.amtByCat[c.key] || 0;
    if(amt > maxAmt){ maxAmt = amt; maxKey = c.key; }
  }
  const maxCat = cats.find(x => x.key === maxKey);
  breakHintEl.textContent = maxCat && maxAmt > 0 ? `${maxCat.label} ê°€ì¥ í¼` : "â€”";

  catListEl.innerHTML = "";
  const total = state.total || 0;

  for(const c of cats){
    const mins = state.minsByCat[c.key] || 0;
    const amt  = state.amtByCat[c.key] || 0;
    const pct  = total > 0 ? (amt/total)*100 : 0;

    const item = document.createElement("div");
    item.className = "catItem";
    item.onclick = () => {
      state.activeKey = c.key;
      pending = 0;
      minsEl.textContent = "0";
      save();
      render();
      closeModal();
    };

    const left = document.createElement("div");
    left.className = "catLeft";

    const name = document.createElement("div");
    name.className = "catName";
    name.textContent = c.label;

    const sub = document.createElement("div");
    sub.className = "catSub";
    sub.textContent = `${mins.toLocaleString("ko-KR")}ë¶„ Â· ${pct.toFixed(0)}%`;

    const bar = document.createElement("div");
    bar.className = "bar";
    const fill = document.createElement("div");
    fill.style.width = `${Math.max(0, Math.min(100, pct))}%`;
    bar.appendChild(fill);

    left.appendChild(name);
    left.appendChild(sub);
    left.appendChild(bar);

    const right = document.createElement("div");
    right.className = "catRight";
    right.textContent = won(amt);

    item.appendChild(left);
    item.appendChild(right);
    catListEl.appendChild(item);
  }
}

/* ===== ë„ë„› ===== */
let selectedKey = null;

function polarToCartesian(cx, cy, r, angleDeg){
  const a = (angleDeg - 90) * Math.PI / 180.0;
  return { x: cx + (r * Math.cos(a)), y: cy + (r * Math.sin(a)) };
}
function donutArcPath(cx, cy, rOuter, rInner, startAngle, endAngle){
  const startOuter = polarToCartesian(cx, cy, rOuter, endAngle);
  const endOuter   = polarToCartesian(cx, cy, rOuter, startAngle);
  const startInner = polarToCartesian(cx, cy, rInner, startAngle);
  const endInner   = polarToCartesian(cx, cy, rInner, endAngle);
  const largeArc = (endAngle - startAngle) <= 180 ? 0 : 1;

  return [
    "M", startOuter.x, startOuter.y,
    "A", rOuter, rOuter, 0, largeArc, 0, endOuter.x, endOuter.y,
    "L", startInner.x, startInner.y,
    "A", rInner, rInner, 0, largeArc, 1, endInner.x, endInner.y,
    "Z"
  ].join(" ");
}

function clearSelectionUI(){
  selectedKey = null;
  selectedMetaEl.textContent = "â— ì „ì²´";
  centerLblEl.textContent = "ì „ì²´";
  // legend ì„ íƒí‘œì‹œ ì œê±°
  legendEl.querySelectorAll(".legendItem").forEach(el => el.classList.remove("selected"));
  // donut í•˜ì´ë¼ì´íŠ¸ ì›ë³µ
  donutSvg.querySelectorAll("path").forEach(p => p.setAttribute("opacity", "0.92"));
}

function renderDonut(){
  donutSvg.innerHTML = "";
  legendEl.innerHTML = "";

  const total = state.total || 0;
  donutTotalEl.textContent = won(total);

  const cx=130, cy=130, rOuter=110, rInner=74;

  // base ring
  const base = document.createElementNS("http://www.w3.org/2000/svg", "circle");
  base.setAttribute("cx", cx);
  base.setAttribute("cy", cy);
  base.setAttribute("r", (rOuter+rInner)/2);
  base.setAttribute("fill", "none");
  base.setAttribute("stroke", "rgba(16,24,40,.10)");
  base.setAttribute("stroke-width", (rOuter-rInner));
  donutSvg.appendChild(base);

  centerAmtEl.textContent = won(total);
  centerLblEl.textContent = "ì „ì²´";

  if(total > 0){
    const values = cats.map(c => ({
      ...c,
      amt: state.amtByCat[c.key] || 0,
      pct: (state.amtByCat[c.key] || 0) / total
    })).filter(d => d.amt > 0);

    let angle = 0;
    values.forEach(d => {
      const sweep = d.pct * 360;
      const start = angle;
      const end = angle + sweep;
      angle = end;

      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute("d", donutArcPath(cx,cy,rOuter,rInner,start,end));
      path.setAttribute("fill", d.color);
      path.setAttribute("data-key", d.key);
      path.setAttribute("opacity", "0.92");
      path.style.cursor = "pointer";
      path.addEventListener("click", () => selectDonut(d.key));
      donutSvg.appendChild(path);
    });
  }

  // legend
  cats.forEach(c => {
    const amt = state.amtByCat[c.key] || 0;
    const mins = state.minsByCat[c.key] || 0;
    const pct = total > 0 ? (amt/total)*100 : 0;

    const row = document.createElement("div");
    row.className = "legendItem";
    row.onclick = () => selectDonut(c.key);

    const left = document.createElement("div");
    left.className = "legendL";

    const sw = document.createElement("div");
    sw.className = "swatch";
    sw.style.background = c.color;

    const nameWrap = document.createElement("div");
    nameWrap.style.minWidth = "0";

    const name = document.createElement("div");
    name.className = "legendName";
    name.textContent = c.label;

    // âœ… í¼ì„¼íŠ¸/ë¶„ì€ ì„ íƒì‹œì—ë§Œ ë³´ì´ê²Œ
    const hint = document.createElement("div");
    hint.className = "legendHint";
    hint.textContent = `${mins.toLocaleString("ko-KR")}ë¶„ Â· ${pct.toFixed(0)}%`;

    nameWrap.appendChild(name);
    nameWrap.appendChild(hint);

    left.appendChild(sw);
    left.appendChild(nameWrap);

    const right = document.createElement("div");
    right.className = "legendAmt";
    right.textContent = won(amt);

    row.appendChild(left);
    row.appendChild(right);
    legendEl.appendChild(row);
  });

  clearSelectionUI();
}

function selectDonut(key){
  const total = state.total || 0;
  const c = cats.find(x => x.key === key);
  if(!c){ clearSelectionUI(); centerAmtEl.textContent = won(state.total || 0); return; }
  const amt = state.amtByCat[key] || 0;
  const pct = total > 0 ? (amt/total)*100 : 0;

  selectedKey = key;
  selectedMetaEl.textContent = c ? `â— ${c.label}` : "â— ì„ íƒ";
  centerAmtEl.textContent = won(amt);
  centerLblEl.textContent = c ? `${c.label} Â· ${pct.toFixed(0)}%` : "ì„ íƒ";

  // legend selected í‘œì‹œ
  legendEl.querySelectorAll(".legendItem").forEach(el => el.classList.remove("selected"));
  const idx = cats.findIndex(x => x.key === key);
  const row = legendEl.children[idx];
  if(row) row.classList.add("selected");

  // donut highlight (data-key ê¸°ì¤€ìœ¼ë¡œ ì•ˆì •ì ìœ¼ë¡œ)
  donutSvg.querySelectorAll("path").forEach(p => p.setAttribute("opacity", "0.25"));
  donutSvg.querySelectorAll("path").forEach(p => {
    if(p.getAttribute("data-key") === key) p.setAttribute("opacity", "0.92");
  });
}

/* ===== ëª¨ë‹¬ ===== */
function openModal(){ renderDonut(); modalEl.classList.add("show"); }
function closeModal(){ modalEl.classList.remove("show"); }

document.getElementById("openChart").onclick = openModal;
document.getElementById("closeModal").onclick = closeModal;
modalEl.addEventListener("click", (e)=>{ if(e.target === modalEl) closeModal(); });

// âœ… â€œì „ì²´â€ ë²„íŠ¼ = ì„ íƒ ì´ˆê¸°í™”
resetDonutBtn.onclick = () => {
  centerAmtEl.textContent = won(state.total || 0);
  clearSelectionUI();
};

/* ===== ë¶„ +/- ===== */
document.getElementById("minus").onclick = () => {
  pending = Math.max(0, pending - 1);
  minsEl.textContent = String(pending);
};
document.getElementById("plus").onclick = () => {
  pending += 1;
  minsEl.textContent = String(pending);
};
document.getElementById("add").onclick = () => {
  if(pending <= 0) return;
  const a = activeCat();
  const addAmt = pending * RATE;

  state.minsByCat[a.key] += pending;
  state.amtByCat[a.key] += addAmt;
  state.total += addAmt;

  pending = 0;
  minsEl.textContent = "0";
  save();
  render();
};


/* ===== ê´€ë¦¬ì ëª¨ë“œ (F1 í† ê¸€) ===== */

/* ===== ëª¨ë°”ì¼ ê´€ë¦¬ì íŠ¸ë¦¬ê±° (íƒ€ì´í‹€ 5ì´ˆ ë¡±í”„ë ˆìŠ¤) ===== */
let adminTimer = null;
const adminTrigger = document.getElementById("adminTrigger");

if(adminTrigger){
  adminTrigger.addEventListener("touchstart", () => {
    adminTimer = setTimeout(() => {
      setAdmin(true); // ê´€ë¦¬ì íŒ¨ë„ ì—´ê¸°
    }, 5000); // 5ì´ˆ
  });

  adminTrigger.addEventListener("touchend", () => {
    clearTimeout(adminTimer);
  });

  adminTrigger.addEventListener("touchmove", () => {
    clearTimeout(adminTimer);
  });
}

const adminPanel = document.getElementById("adminPanel");
const adminClose = document.getElementById("adminClose");
const adminMinus = document.getElementById("adminMinus");
const adminPlus  = document.getElementById("adminPlus");
const adminReset = document.getElementById("adminReset");
const adminResetText = document.getElementById("adminResetText");

let adminOpen = false;
function setAdmin(open){
  if(!adminPanel) return;
  adminOpen = open;
  adminPanel.style.display = open ? "block" : "none";
  if(open && adminResetText) adminResetText.value = "";
}

// F1ì€ ë¸Œë¼ìš°ì € ë„ì›€ë§ì´ ëœ° ìˆ˜ ìˆì–´ì„œ ê¸°ë³¸ë™ì‘ ë§‰ê³  í† ê¸€
document.addEventListener("keydown", (e) => {
  if(e.key === "F1"){
    e.preventDefault();
    setAdmin(!adminOpen);
  }
});

if(adminClose) adminClose.onclick = () => setAdmin(false);

// ì„ íƒëœ ì¹´í…Œê³ ë¦¬ì˜ ë¶„/ê¸ˆì•¡/ì´ì•¡ì„ í•¨ê»˜ ë³´ì • (0 ì•„ë˜ë¡œëŠ” ë‚´ë ¤ê°€ì§€ ì•ŠìŒ)
function adjustMinutes(delta){
  const a = activeCat();
  if(!a) return;

  const curMins = state.minsByCat[a.key] || 0;
  const nextMins = Math.max(0, curMins + delta);
  const appliedDelta = nextMins - curMins; // ì‹¤ì œë¡œ ì ìš©ëœ ë³€í™”ëŸ‰

  if(appliedDelta === 0) return;

  state.minsByCat[a.key] = nextMins;

  const deltaAmt = appliedDelta * RATE;
  state.amtByCat[a.key] = Math.max(0, (state.amtByCat[a.key] || 0) + deltaAmt);
  state.total = Math.max(0, state.total + deltaAmt);

  save();
  render();
}

if(adminMinus) adminMinus.onclick = () => adjustMinutes(-1);
if(adminPlus)  adminPlus.onclick  = () => adjustMinutes(+1);

// ì´ˆê¸°í™”: RESET ì…ë ¥ + confirm 2ì¤‘ ì•ˆì „ì¥ì¹˜
if(adminReset) adminReset.onclick = () => {
  const txt = (adminResetText?.value || "").trim().toUpperCase();
  if(txt !== "RESET"){
    alert("ì´ˆê¸°í™”ë¥¼ í•˜ë ¤ë©´ RESETì„ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }
  if(!confirm("ì •ë§ ì´ˆê¸°í™”í• ê¹Œìš”? (ì´ ê¸°ê¸° ì €ì¥ ê¸°ë¡ì´ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤)")) return;

  localStorage.removeItem(STORAGE_KEY);

  state = {
    activeKey: "me",
    total: 0,
    minsByCat: Object.fromEntries(cats.map(c => [c.key, 0])),
    amtByCat: Object.fromEntries(cats.map(c => [c.key, 0])),
  };
  pending = 0;
  prevCoins = null;

  save();
  render();
  setAdmin(false);
};


/* ===== ë Œë” ===== */
function render(){
  renderTabs();
  renderHeader();
  renderCoins();
  renderCatList();
}
render();
</script>
</body>
</html>